<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a New Listing - USC Subletting Web Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <script src = "loginregister.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg ">
        <div class="container-fluid">
            <a class="navbar-brand" href="browse.html">USC Subletting</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="browse.html">Browse</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Messages.html">Messages</a>
                    </li>
                </ul>
                <p>You are logged in as</p>
                <button onclick="logout();" class="btn" type="button">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>Create a New Listing!</h1>
        <form>
            <div class="row g-3">
                <div class="col-sm-6">
                    <label for="listingTitle" class="form-label">Listing Title</label>
                    <input type="text" class="form-control" id="listingTitle" placeholder="[single/double] room in [apartment/house] near [location]">
                </div>

                <div class="col-sm-6">
                    <label for="propertyType" class="form-label">Property Type</label>
                    <br>
                    <select id="propertyType" name="propertyType" size="3">
                        <option value="1">Apartment</option>
                        <option value="2">House</option>
                        <option value="3">Room</option>
                    </select>    
                </div>

                <div class="col-sm-6">
                    <label for="address" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address">
                </div>

                <div class="col-sm-6">
                    <label for="monthlyPrice" class="form-label">Monthly Price</label>
                    <input type="text" class="form-control" id="monthlyPrice">
                </div>

                <div class="col-sm-6">
                    <label for="numBedrooms" class="form-label">Number of Bedrooms</label>
                    <input type="text" class="form-control" id="bedrooms">
                </div>

                <div class="col-sm-6">
                    <label for="bathrooms" class="form-label">Number of Bathrooms</label>
                    <input type="text" class="form-control" id="bathrooms">
                </div>

                <div class="col-sm-6">
                    <label for="startDate" class="form-label">Start Date</label>
                    <input type="date" class="form-control" id="startDate" placeholder="Available [Month Year] - [Month Year]">
                </div>

                <div class="col-sm-6">
                    <label for="endDate" class="form-label">End Date:</label>
                    <input type="date" class="form-control" id="endDate" placeholder="Available [Month Year] - [Month Year]">
                </div>
                
                <div class="col-sm-6">
                    <label for="size" class="form-label">Size</label>
                    <input type="text" class="form-control" id="size" placeholder="[number] square feet">
                </div>
                
                <div class="col-12">
                    <label for="description" class="form-label">Description</label>
                    <input type="text" class="form-control" id="description">
                </div>

                <div class="col-12">
                    <label for="photoUpload" class="form-label">Photo Upload 1</label>
                    <input type="file" class="form-control" id="photoUpload">
                    
                    <label for="photoUpload" class="form-label">Photo Upload 2</label>
                    <input type="file" class="form-control" id="photoUpload">
                    
                    <label for="photoUpload" class="form-label">Photo Upload 3</label>
                    <input type="file" class="form-control" id="photoUpload">
                </div>
                <div class="col-12">
                    <button id="submit-button" type="submit" class="btn btn-custom">Submit</button>
                </div>
            </div>
        </form>
    </div>
    
    <footer>
        <p>Â© 2024 USC Subletting. All rights reserved.</p>
    </footer>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        //calls CreatePostServlet
        document.getElementById("submit-button").addEventListener('click', function() {
            event.preventDefault();
            const listingTitle = document.getElementById("listingTitle").value;
            let propertyType = document.getElementById("propertyType").value;
            const propertyPrice = document.getElementById("propertyType").value;
            const address = document.getElementById("address").value;
            const monthlyPrice = document.getElementById("monthlyPrice").value;
            const bedrooms = document.getElementById("bedrooms").value;
            const bathrooms = document.getElementById("bathrooms").value;
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;
            const size = document.getElementById("size").value;
            //check that all fields are filled
            if (listingTitle.length === 0 || propertyType.length === 0 || propertyPrice.length === 0 || address.length == 0
                || monthlyPrice.length === 0 || bedrooms.length === 0 || bathrooms.length === 0 || startDate.length === 0
                || endDate.length === 0 || size.length === 0)
		    {
			    alert("Please fill out all required fields!");
		    }
            //send to servlet
            else
            {
                if (propertyType === 1)
                {
                    propertyType = "Apartment";
                }
                if (propertyType === 2)
                {
                    propertyType = "House";
                }
                else 
                {
                    propertyType = "Room";
                }
                const data = {
			        listingTitle: listingTitle,
                    propertyPrice: propertyPrice,
                    address: address,
                    monthlyPrice: monthlyPrice,
			        bedrooms: bedrooms,
                    bathrooms: bathrooms, 
                    startDate: startDate,
                    endDate: endDate,
                    size: size,
			    };
			    fetch('CreatePostServlet', {
			        method: 'POST',
			        headers: {
			            'Content-Type': 'application/json',
			        },
			        body: JSON.stringify(data),
			    })
			    .then(response => {
                    if (response.ok)
                    {
                        alert("Successfully listed post");
                        //could redirect to a different webpage here
                    }
                    else 
                    {
                        return response.json();
                    }
                })
                .then(data => {
			        if (data != null)
			        {
			        	alert(data);
			        }
			    })
                .catch(error => {
			        alert(error);
			    }); 
            }
        })
    </script>


</body>
</html>
